(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[915],{62367:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/config-cluster",function(){return r(40947)}])},40947:function(e,s,r){"use strict";r.r(s);var i=r(85893),t=r(67294),n=r(87536),l=r(38679),a=r(94736),d=r(27183),o=r(87708),c=r(84496),p=r(11163),u=r(2954),h=r(34695),v=r(30272),m=r(16052),x=r(70521);let ConfigCluster=()=>{var e,s,r,g,w,f;let j=(0,c.o)(e=>e.clusterDefinition),{control:b,register:C,handleSubmit:_,formState:{errors:A,isDirty:R,isValid:S},resetField:y,setValue:k,trigger:$,getValues:N}=(0,n.cI)({mode:"onChange",defaultValues:{operators:u.fI,recipients:u.tT,singleAddress:"",feeRecipientAddress:"",principal:"",enr:"",name:""}}),{fields:T,append:O,remove:E}=(0,n.Dq)({control:b,name:"operators"}),{fields:P,append:z,remove:D}=(0,n.Dq)({control:b,name:"recipients"}),Q=(0,p.useRouter)(),V=(0,c.o)(e=>e.completeLeaderStep),I=(0,c.o)(e=>e.enableLeaderStep),W=(0,c.o)(e=>e.updateClusterDefinition),[F,G]=(0,t.useState)(100),{account:L}=(0,o.kR)(),[q,H]=(0,t.useState)((null==j?void 0:j.clusterSize)||u.dd),J=(0,o.D9)(q),[M,B]=(0,t.useState)((null==j?void 0:j.validatorsSize)||1),[X,Z]=(0,t.useState)((0,x.c)("split_withdrawal_flow")&&(!(null==j?void 0:j.principal)&&!(null==j?void 0:j.singleAddress)&&(null==j?void 0:null===(e=j.recipients)||void 0===e?void 0:e.every(e=>(0,v.H6)(e)))||!(0,x.c)("single_withdrawal_address_flow")&&!(0,x.c)("reward_split_withdrawal_flow"))?"splitter":(0,x.c)("reward_split_withdrawal_flow")&&((null==j?void 0:j.principal)&&!(null==j?void 0:j.singleAddress)&&(null==j?void 0:null===(s=j.recipients)||void 0===s?void 0:s.every(e=>(0,v.H6)(e)))||!(0,x.c)("single_withdrawal_address_flow"))?"reward_splitter":"single"),[K,U]=(0,t.useState)(),handleOnAddRecipientRow=()=>{z({address:"",split:""})},handleOnRemoveRecipient=e=>{D(e);let s=N().recipients.reduce((e,s)=>s.split?parseFloat(s.split)+e:e,0);G(s)},handleOnSetAccountAsOperator=e=>{e.preventDefault(),k("operators.0",{address:L}),$("operators.0")};return(0,t.useEffect)(()=>{X&&(y("singleAddress"),y("feeRecipientAddress"),y("principal"),y("recipients"),W({...j,validators:[]}))},[X]),(0,t.useEffect)(()=>{if(q){let e=(0,v.zT)(q);U(e)}J&&J<q&&O({address:""},{shouldFocus:!1}),J&&J>q&&E(q-1)},[J,q]),(0,t.useEffect)(()=>{k("singleAddress",null==j?void 0:j.singleAddress),k("feeRecipientAddress",null==j?void 0:j.feeRecipientAddress),k("enr",null==j?void 0:j.enr),k("name",null==j?void 0:j.name),k("principal",null==j?void 0:j.principal),(null==j?void 0:j.operators)&&k("operators",null==j?void 0:j.operators),(null==j?void 0:j.recipients)&&k("recipients",null==j?void 0:j.recipients)},[]),(0,i.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,i.jsx)(l.xv,{variant:"h3",children:"Configure Cluster"}),(0,i.jsx)(a.l0,{onSubmit:_(e=>{V("config-cluster"),W({...e,creator:{address:L},validatorsEthAmount:32*M,validators:Array(M).fill({feeRecipientAddress:e.feeRecipientAddress,withdrawalAddress:e.singleAddress})});let s=I("confirm-configuration");Q.push(s.href)}),children:(0,i.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,i.jsx)(l.W2,{className:"cluster-details",alignItems:"start",children:(0,i.jsx)(m.PQ,{register:C,clusterSize:q,setClusterSize:H,control:b,min:u.dd})}),(0,i.jsxs)(l.W2,{className:"cluster-operators",alignItems:"start",children:[(0,i.jsx)(l.xv,{variant:"h4",children:"Node Operators"}),T.map((e,s)=>{var r,t,n;return(0,i.jsxs)(l.kC,{direction:"column",css:{gap:"$sm","& div > input":{color:"$obolGreen"}},children:[(0,i.jsxs)(l.kC,{direction:"column",css:{gap:"$sm"},children:[(0,i.jsxs)(l.kC,{css:{gap:"$sm",justifyContent:"space-between"},children:[(0,i.jsx)(l.xv,{variant:"subline",color:"body",css:{textTransform:"uppercase"},children:"Operator ".concat(s+1,"/").concat(q)}),0===s&&(0,i.jsx)(l.zx,{ghost:!0,css:{color:"$obolGreen",fontSize:"$1",p:0,height:"100%",textTransform:"uppercase"},onClick:handleOnSetAccountAsOperator,children:"use my address"})]}),(0,i.jsx)(d.bQ,{"data-testid":"Operator ".concat(s+1),control:b,trigger:$,name:"operators.".concat(s,".address"),items:N().operators,wrapperCSS:{border:"2px solid $bg04",backgroundColor:"$bg03",borderRadius:"$1",px:"$sm",py:"$xs","&:focus-within":{backgroundColor:"$bg02"}}})]}),(null===(r=A.operators)||void 0===r?void 0:r[s])&&(0,i.jsx)(l.xv,{variant:"metadata",color:"test",children:null===(n=A.operators)||void 0===n?void 0:null===(t=n[s].address)||void 0===t?void 0:t.message})]},":op".concat(e&&e.id,":"))})]}),(0,i.jsx)(m.J1,{control:b,contractType:X,validatorsSize:M,setValidatorsSize:B}),N().operators.some(e=>e.address===L)&&(0,i.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,i.jsxs)(l.kC,{direction:"column",css:{gap:"$sm"},children:[(0,i.jsxs)(l.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,i.jsx)(l.xv,{variant:"subline",color:"body",css:{textTransform:"uppercase"},children:"What is your Charon Client's ENR?"}),(0,i.jsx)(l.KZ,{content:"An ENR is a public key and encoded networking info starting with enr:-...",children:(0,i.jsx)(l.xu,{css:{display:"flex"},children:(0,i.jsx)(l.by,{})})})]}),(0,i.jsx)(d.iA,{control:b,name:"enr"})]}),(0,i.jsxs)(l.rU,{href:"https://docs.obol.tech/docs/start/quickstart_group#step-1-generate-an-enr",target:"_blank",children:["How to generate your ENR ",(0,i.jsx)(l.ZJ,{})]})]}),(0,i.jsxs)(l.W2,{className:"withdrawal-section",css:{gap:"$lg"},alignItems:"start",children:[(0,i.jsx)(l.xv,{variant:"h4",children:"Withdrawal Configuration"}),(0,i.jsxs)(l.mQ.Tabs,{defaultValue:X,onValueChange:e=>Z(h.RJ[e]),"aria-label":"View density",css:{width:"100%"},children:[(0,i.jsxs)(l.mQ.TabsList,{"aria-label":"Configure Withdrawal",children:[(0,i.jsx)(x.T,{name:"single_withdrawal_address_flow",children:(0,i.jsx)(l.mQ.TabsTrigger,{value:"single",disabled:!(0,x.c)("single_withdrawal_address_flow"),children:"Default"})}),(0,i.jsx)(x.T,{name:"reward_split_withdrawal_flow",children:(0,i.jsx)(l.mQ.TabsTrigger,{value:"reward_splitter",disabled:!(0,x.c)("reward_split_withdrawal_flow"),children:"Split Only Rewards"})}),(0,i.jsx)(x.T,{name:"split_withdrawal_flow",children:(0,i.jsx)(l.mQ.TabsTrigger,{value:"splitter",disabled:!(0,x.c)("split_withdrawal_flow"),children:"Split Principal & Rewards"})})]}),(0,i.jsx)(l.mQ.TabsContent,{value:"single",children:(0,i.jsxs)(l.kC,{direction:"column",css:{gap:"$md",pt:"$sm"},children:[(0,i.jsx)(m.AN,{control:b,trigger:$,errors:A,handleOnSetAddress:e=>{e.preventDefault(),k("singleAddress",L),$("singleAddress")},heading:"Principal Address",description:"Address to receive validator principal and rewards at exit.",fieldName:"singleAddress",className:"single-address-section"}),(0,i.jsx)(m.AN,{control:b,trigger:$,errors:A,handleOnSetAddress:e=>{e.preventDefault(),k("feeRecipientAddress",L),$("feeRecipientAddress")},heading:"Fee Recipient",description:"Enter the Fee Recipient Address to receive MEV rewards (if enabled), block proposal and priority fees.",fieldName:"feeRecipientAddress",className:"fee-recipient-address-section"})]})}),(0,i.jsx)(l.mQ.TabsContent,{value:"reward_splitter",children:(0,i.jsxs)(l.kC,{direction:"column",css:{gap:"$md",pt:"$sm"},children:[(0,i.jsx)(m.AN,{control:b,trigger:$,errors:A,handleOnSetAddress:e=>{e.preventDefault(),k("principal",L),$("principal")},heading:"Principal Recipient",description:"Address that will reclaim validator principal after exit.",fieldName:"principal",className:"splitter-principal-section"}),(0,i.jsxs)(l.kC,{direction:"column",className:"splitter-reward-recipients-section",css:{gap:"$xs"},children:[(0,i.jsx)(l.xv,{variant:"h5",children:"Rewards Split"}),(0,i.jsxs)(l.kC,{css:{justifyContent:"space-between"},direction:"column",children:[(0,i.jsx)(l.xv,{color:"body",variant:"body",css:{mb:"$lg"},children:"Enter each recipients address and their share. Ownership must add to 100%."}),(0,i.jsx)(l.xv,{color:"body",variant:"body",children:"By default, a contribution is allocated to be used by Obol for Public Goods."})]}),(0,i.jsx)(m.Cl,{columns:(0,u.TV)("Rewards"),rows:P,onAddRow:handleOnAddRecipientRow,onRemoveRow:handleOnRemoveRecipient,totalSplitFooter:F,setMaxSplit:G,control:b,trigger:$,recipients:N().recipients}),(null===(r=A.recipients)||void 0===r?void 0:r.some(e=>{var s;return null==e?void 0:null===(s=e.address)||void 0===s?void 0:s.message}))&&(0,i.jsx)(l.xv,{variant:"metadata",color:"test",children:"Please enter a valid, non-duplicate Ethereum address or ENS name"}),(null===(g=A.recipients)||void 0===g?void 0:g.some(e=>{var s;return null==e?void 0:null===(s=e.split)||void 0===s?void 0:s.message}))&&(0,i.jsx)(l.xv,{variant:"metadata",color:"test",children:"Split value should be greater than 0%"})]})," "]})}),(0,i.jsx)(l.mQ.TabsContent,{value:"splitter",children:(0,i.jsxs)(l.kC,{direction:"column",css:{gap:"$md",pt:"$sm"},children:[(0,i.jsxs)(l.kC,{direction:"column",className:"splitter-reward-recipients-section",css:{gap:"$xs"},children:[(0,i.jsx)(l.xv,{variant:"h5",children:"Principal & Rewards Split"}),(0,i.jsxs)(l.kC,{css:{justifyContent:"space-between"},direction:"column",children:[(0,i.jsx)(l.xv,{color:"body",variant:"body",css:{mb:"$lg"},children:"Enter each recipients address and their share. Ownership must add to 100%."}),(0,i.jsx)(l.xv,{color:"body",variant:"body",children:"By default, a contribution is allocated to be used by Obol for Public Goods."})]}),(0,i.jsx)(m.Cl,{columns:(0,u.TV)("Principal & Rewards"),rows:P,onAddRow:handleOnAddRecipientRow,onRemoveRow:handleOnRemoveRecipient,totalSplitFooter:F,setMaxSplit:G,control:b,trigger:$,validatorsSize:M,recipients:N().recipients}),(null===(w=A.recipients)||void 0===w?void 0:w.some(e=>{var s;return null==e?void 0:null===(s=e.address)||void 0===s?void 0:s.message}))&&(0,i.jsx)(l.xv,{variant:"metadata",color:"test",children:"Please enter a valid, non-duplicate Ethereum address or ENS name"}),(null===(f=A.recipients)||void 0===f?void 0:f.some(e=>{var s;return null==e?void 0:null===(s=e.split)||void 0===s?void 0:s.message}))&&(0,i.jsx)(l.xv,{variant:"metadata",color:"test",children:"Split value should be greater than 0%"})]})," "]})})]})]}),(0,i.jsx)(l.kC,{direction:"column",children:(0,i.jsx)(l.zx,{color:"primary",type:"submit",disabled:!R||!S||!L||100!==F,children:"Create Cluster Configuration"})})]})})]})};s.default=ConfigCluster,ConfigCluster.layout="ProgressTrackerLayout"}},function(e){e.O(0,[774,888,179],function(){return e(e.s=62367)}),_N_E=e.O()}]);